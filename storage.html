<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>アカウントとアップボート率</title>
  <style>
    :root{--bg:#f6f8fb;--card:#fff;--accent:#2563eb;--muted:#666}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); margin:0; padding:24px; color:#111}
    .container{max-width:600px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:var(--card);border-radius:10px;padding:16px;box-shadow:0 4px 12px rgba(20,20,40,0.06)}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px 8px;text-align:left;border-bottom:1px solid #f1f3f6}
    th{font-size:13px;color:var(--muted)}
    .empty{padding:28px;text-align:center;color:var(--muted)}
    form{display:flex;gap:8px;margin-bottom:12px}
    input[type=text]{flex:1;padding:6px;border-radius:6px;border:1px solid #e6e9ef}
    button{background:var(--accent);color:#fff;padding:6px 10px;border-radius:6px;border:0;cursor:pointer}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>アカウントとアップボート率</h1>
    </header>

    <section class="card">
      <form id="addForm">
        <input type="text" id="name" placeholder="アカウント名" required />
        <input type="text" id="rate" placeholder="アップボート率" required />
        <button type="submit">追加</button>
      </form>

      <div id="listArea"></div>

      <div style="margin-bottom:8px">
        <button id="exportBtn">JSONエクスポート</button>
        <label for="importFile" style="cursor:pointer; margin-left:8px; padding:6px 10px; background:#eee; border-radius:6px;">JSONインポート</label>
        <input type="file" id="importFile" accept="application/json" style="display:none;" />
      </div>
      
    </section>

    <p style="margin-top:10px;color:var(--muted);font-size:13px">※ ブラウザのlocalStorageに保存されます。</p>
  </div>

  <script>
    const STORAGE_KEY = 'accounts';
    const listArea = document.getElementById('listArea');
    const addForm = document.getElementById('addForm');
    const nameInput = document.getElementById('name');
    const rateInput = document.getElementById('rate');
    const exportBtn = document.getElementById('exportBtn');
    const importFile = document.getElementById('importFile');

    function loadAccounts(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return [];
      try { return JSON.parse(raw); } catch { return []; }
    }

    function saveAccounts(accounts){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(accounts));
    }

    function uid(){ return 'id-' + Math.random().toString(36).slice(2,9); }

    let accounts = loadAccounts();

    function renderList(){
      if(accounts.length === 0){
        listArea.innerHTML = '<div class="empty">登録されたアカウントがありません。</div>';
        return;
      }
      let html = '<table><thead><tr><th>アカウント名</th><th>アップボート率</th><th>操作</th></tr></thead><tbody>';
      accounts.forEach(acc=>{
        html += `<tr data-id="${acc.id}"><td>${escapeHtml(acc.name)}</td><td>${escapeHtml(acc.rate)}</td>`+
                `<td><button data-action="delete">削除</button></td></tr>`;
      });
      html += '</tbody></table>';
      listArea.innerHTML = html;

      listArea.querySelectorAll('button[data-action]').forEach(btn=>{
        btn.addEventListener('click', e=>{
          const tr = e.target.closest('tr');
          const id = tr.getAttribute('data-id');
          accounts = accounts.filter(a=>a.id!==id);
          saveAccounts(accounts);
          renderList();
        });
      });
    }

    function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }

    addForm.addEventListener('submit', e=>{
      e.preventDefault();
      const name = nameInput.value.trim();
      const rate = rateInput.value.trim();
      if(!name || !rate) return;
      accounts.push({id: uid(), name, rate});
      saveAccounts(accounts);
      renderList();
      addForm.reset();
      nameInput.focus();
    });

    exportBtn.addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(accounts, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'accounts.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    importFile.addEventListener('change', async (e)=>{
      const file = e.target.files[0];
      if(!file) return;
      try {
        const text = await file.text();
        const imported = JSON.parse(text);
        if(!Array.isArray(imported)) throw new Error('配列形式のJSONが必要です');
        imported.forEach(item=>{
          if(!item.id) item.id = uid();
          accounts.push(item);
        });
        saveAccounts(accounts);
        renderList();
        importFile.value = '';
      } catch(err){
        alert('インポートに失敗しました: ' + err.message);
      }
    });

    renderList();
  </script>
</body>
</html>
