<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>localStorageでアカウント一覧</title>
  <style>
    :root{--bg:#f6f8fb;--card:#fff;--accent:#2563eb;--muted:#666}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); margin:0; padding:24px; color:#111}
    .container{max-width:600px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:var(--card);border-radius:10px;padding:16px;box-shadow:0 4px 12px rgba(20,20,40,0.06)}
    .toolbar{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .meta{font-size:13px;color:var(--muted)}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px 8px;text-align:left;border-bottom:1px solid #f1f3f6}
    th{font-size:13px;color:var(--muted)}
    .empty{padding:28px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>アカウント一覧</h1>
      <div class="meta">保存キー: <span class="meta" id="storageKey">accounts</span></div>
    </header>

    <section class="card">
      <div class="toolbar">
        <button id="clearAllBtn">すべて削除</button>
      </div>
      <div id="listArea"></div>
    </section>

    <p style="margin-top:10px;color:var(--muted);font-size:13px">※ ブラウザのlocalStorageに保存されます。</p>
  </div>

  <script>
    const STORAGE_KEY = 'accounts';

    function loadAccounts(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return [];
        return JSON.parse(raw);
      }catch(e){ return []; }
    }

    function saveAccounts(accounts){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(accounts));
    }

    const listArea = document.getElementById('listArea');
    let accounts = loadAccounts();

    function renderList(){
      if(accounts.length === 0){
        listArea.innerHTML = '<div class="empty">登録されたアカウントがありません。</div>';
        return;
      }
      let html = '<table><thead><tr><th>アカウント名</th><th>アップデート率</th><th>操作</th></tr></thead><tbody>';
      accounts.forEach(acc => {
        html += `<tr data-id="${acc.id}"><td>${escapeHtml(acc.name)}</td><td>${escapeHtml(acc.rate)}</td>`+
                `<td><button data-action="delete">削除</button></td></tr>`;
      });
      html += '</tbody></table>';
      listArea.innerHTML = html;

      listArea.querySelectorAll('button[data-action]').forEach(btn=>{
        btn.addEventListener('click', e=>{
          const tr = e.target.closest('tr');
          const id = tr.getAttribute('data-id');
          accounts = accounts.filter(a=>a.id!==id);
          saveAccounts(accounts);
          renderList();
        });
      });
    }

    function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }

    document.getElementById('clearAllBtn').addEventListener('click', ()=>{
      if(confirm('本当にすべて削除しますか？')){
        accounts = [];
        saveAccounts(accounts);
        renderList();
      }
    });

    renderList();
  </script>
</body>
</html>
